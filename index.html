<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StreamDock V4 - Mobile Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body {
            background-color: #020617;
            color: #f8fafc;
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            touch-action: none; /* Kaydırmayı engelle, sadece sürüklemeye odaklan */
        }

        .permission-overlay {
            background: linear-gradient(135deg, #0f172a 0%, #020617 100%);
        }

        #floating-control {
            position: fixed;
            width: 50px;
            height: 50px;
            background: #3b82f6;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            cursor: pointer;
            transition: opacity 0.4s, transform 0.4s;
        }

        .idle { opacity: 0.2; transform: scale(0.85); }

        #action-panel {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.98);
            z-index: 2000;
            display: none;
            flex-direction: column;
            padding: 20px;
        }

        .glass { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; }
    </style>
</head>
<body>

    <!-- Başlangıç Ekranı -->
    <div id="init-screen" class="permission-overlay fixed inset-0 flex flex-col items-center justify-center p-6 text-center">
        <div class="mb-8">
            <h1 class="text-4xl font-black italic tracking-tighter mb-2">STREAM<span class="text-blue-500">DOCK</span> V4</h1>
            <p class="text-slate-400 text-sm">Mobil Yayın Yönetim Konsolu</p>
        </div>

        <div class="w-full max-w-xs space-y-4">
            <div class="bg-slate-900/50 p-4 rounded-2xl border border-white/5 text-left">
                <p class="text-[11px] font-bold text-slate-500 uppercase mb-2">Gereksinimler</p>
                <ul class="text-xs space-y-2 text-slate-300">
                    <li class="flex items-center">✅ HTTPS Bağlantısı Aktif</li>
                    <li class="flex items-center">✅ Chrome Tarayıcı Tespit Edildi</li>
                    <li id="req-mic" class="flex items-center text-slate-500">⚪ Mikrofon Erişimi Bekleniyor</li>
                    <li id="req-scr" class="flex items-center text-slate-500">⚪ Ekran Yayını Bekleniyor</li>
                </ul>
            </div>

            <button onclick="startPermissionFlow()" class="w-full py-5 bg-blue-600 hover:bg-blue-500 text-white rounded-3xl font-black text-lg shadow-xl shadow-blue-900/20 active:scale-95 transition-all">
                YAYINI HAZIRLA
            </button>
        </div>

        <p id="error-log" class="mt-6 text-red-400 text-[10px] hidden font-bold max-w-xs"></p>
    </div>

    <!-- Sürüklenebilir Kontrol Tuşu -->
    <div id="floating-control" onmousedown="startDrag(event)" ontouchstart="startDrag(event)">
        <div class="w-3 h-3 bg-white rounded-full animate-pulse"></div>
    </div>

    <!-- Kontrol Paneli -->
    <div id="action-panel">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-black italic">DOCK <span class="text-blue-500">PRO</span></h2>
            <button onclick="togglePanel()" class="text-slate-500 font-bold p-2">KAPAT [X]</button>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6">
            <div class="glass p-5 text-center">
                <p class="text-[10px] text-slate-500 font-bold mb-1">ABONE</p>
                <p id="sub-count" class="text-3xl font-black text-blue-400">1.420</p>
            </div>
            <div class="glass p-5 text-center">
                <p class="text-[10px] text-slate-500 font-bold mb-1">İZLEYİCİ</p>
                <p class="text-3xl font-black text-purple-400">89</p>
            </div>
        </div>

        <div class="flex-1 glass p-4 overflow-hidden flex flex-col mb-6">
            <p class="text-[10px] font-bold text-slate-500 mb-3 tracking-widest uppercase">Şeffaf Chat</p>
            <div id="chat-box" class="flex-1 overflow-y-auto space-y-3 text-sm">
                <p><span class="text-blue-500 font-bold">Admin:</span> Sistem aktif.</p>
                <p><span class="text-slate-400 font-bold">Sistem:</span> Yayın akışı kontrol ediliyor.</p>
            </div>
        </div>

        <button onclick="location.reload()" class="w-full py-5 bg-red-600 rounded-3xl font-black tracking-widest shadow-lg shadow-red-900/40">
            ANI KAPAT (PANIC)
        </button>
    </div>

    <script>
        let isDragging = false;
        let idleTimer;
        const floatBtn = document.getElementById('floating-control');
        const actionPanel = document.getElementById('action-panel');

        async function startPermissionFlow() {
            const errorLog = document.getElementById('error-log');
            errorLog.classList.add('hidden');

            try {
                // 1. Mikrofon
                const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                document.getElementById('req-mic').innerHTML = "✅ Mikrofon İzni Alındı";
                document.getElementById('req-mic').classList.replace('text-slate-500', 'text-green-400');

                // 2. Ekran (Bu genellikle mobil Chrome'da en çok takılan kısımdır)
                const screenStream = await navigator.mediaDevices.getDisplayMedia({ 
                    video: true,
                    audio: true
                });
                
                document.getElementById('req-scr').innerHTML = "✅ Ekran İzni Alındı";
                document.getElementById('req-scr').classList.replace('text-slate-500', 'text-green-400');

                // Başarılı ise arayüzü değiştir
                setTimeout(() => {
                    document.getElementById('init-screen').style.display = 'none';
                    floatBtn.style.display = 'flex';
                    floatBtn.style.left = (window.innerWidth - 70) + 'px';
                    floatBtn.style.top = (window.innerHeight / 2) + 'px';
                    resetIdle();
                }, 500);

            } catch (err) {
                errorLog.classList.remove('hidden');
                console.error(err);
                if (err.name === 'NotAllowedError') {
                    errorLog.innerText = "HATA: İzin reddedildi. Lütfen tarayıcı ayarlarından siteye Kamera/Mikrofon izni verin ve tekrar deneyin.";
                } else {
                    errorLog.innerText = "HATA: " + err.message + ". Cihazınız bu özelliği desteklemiyor olabilir.";
                }
            }
        }

        // Sürükleme Mantığı (Mobil Touch dahil)
        function startDrag(e) {
            isDragging = true;
            floatBtn.classList.remove('idle');
            clearTimeout(idleTimer);
            
            const move = (ev) => {
                if (!isDragging) return;
                const clientX = ev.touches ? ev.touches[0].clientX : ev.clientX;
                const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
                
                floatBtn.style.left = (clientX - 25) + 'px';
                floatBtn.style.top = (clientY - 25) + 'px';
            };

            const end = () => {
                if(isDragging) {
                    isDragging = false;
                    // Eğer çok az hareket ettiyse tıklandı say
                    togglePanel();
                    resetIdle();
                }
                window.removeEventListener('mousemove', move);
                window.removeEventListener('mouseup', end);
                window.removeEventListener('touchmove', move);
                window.removeEventListener('touchend', end);
            };

            window.addEventListener('mousemove', move);
            window.addEventListener('mouseup', end);
            window.addEventListener('touchmove', move, { passive: false });
            window.addEventListener('touchend', end);
        }

        function togglePanel() {
            if (actionPanel.style.display === 'flex') {
                actionPanel.style.display = 'none';
                resetIdle();
            } else {
                actionPanel.style.display = 'flex';
            }
        }

        function resetIdle() {
            floatBtn.classList.remove('idle');
            clearTimeout(idleTimer);
            idleTimer = setTimeout(() => {
                if (actionPanel.style.display !== 'flex') {
                    floatBtn.classList.add('idle');
                }
            }, 3000);
        }

        // Abone sayacı simülasyonu
        setInterval(() => {
            if (Math.random() > 0.7) {
                const sub = document.getElementById('sub-count');
                sub.innerText = (parseInt(sub.innerText.replace('.','')) + 1).toLocaleString();
            }
        }, 3000);

    </script>
</body>
</html>

